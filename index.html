<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Video Library</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
  margin: 0;
  padding: 20px;
}
h1 { text-align:center; margin-bottom:25px; }

#lockScreen {
  position: fixed;
  inset: 0;
  background: #0f0f0f;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#lockBox {
  background: #181818;
  padding: 30px;
  border-radius: 14px;
  text-align: center;
  width: 300px;
}

#lockBox input {
  width: 100%;
  padding: 10px;
  margin-top: 15px;
  background: #101010;
  color: white;
  border: 1px solid #333;
  border-radius: 8px;
}

#lockBox button {
  margin-top: 15px;
  width: 100%;
  padding: 10px;
  background: #272727;
  color: white;
  border: 1px solid #444;
  border-radius: 10px;
  cursor: pointer;
}

.top-bar {
  text-align: center;
  margin-bottom: 35px;
}

.top-bar input {
  padding: 10px;
  width: 260px;
  margin: 5px;
  background: #181818;
  color: #fff;
  border: 1px solid #303030;
  border-radius: 6px;
}

.top-bar button {
  padding: 10px 14px;
  background: #272727;
  border: 1px solid #3a3a3a;
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
  font-size: 18px;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 22px;
  max-width: 1400px;
  margin: auto;
}

.video-card {
  background: #181818;
  padding: 10px;
  border-radius: 14px;
}

iframe {
  width: 100%;
  height: 200px;
  border-radius: 12px;
  border: none;
}

.title {
  text-align: center;
  margin-top: 8px;
  font-size: 14px;
  cursor: pointer;
}

.title-edit {
  width: 100%;
  padding: 6px;
  background: #101010;
  color: white;
  border: 1px solid #444;
  border-radius: 6px;
  text-align: center;
}

.actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
}

.delete-btn {
  width: 36px;
  height: 36px;
  background: #2a2a2a;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="lockScreen">
  <div id="lockBox">
    <h2>ðŸ”’ Locked</h2>
    <input id="pagePasswordInput" type="password" placeholder="Enter password">
    <button onclick="unlockPage()">Unlock</button>
  </div>
</div>

<h1>My Video Collection</h1>

<div class="top-bar">
  <input id="videoUrl" placeholder="Paste URL">
  <input id="videoTitle" placeholder="Video title">
  <br>
  <button onclick="addVideo()">âž•</button>
</div>

<div class="video-grid" id="videoGrid"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwTRJPtobDZzuGvNYsfz3lFAQAOYux62J5wU1PRwmPrJODYNkg8vwuNdw2kpNxPLvcE/exec";

let PAGE_PASSWORD = "";
let DELETE_PASSWORD = "";

async function init() {
  const res = await fetch(API_URL);
  const json = await res.json();
  PAGE_PASSWORD = json.pagePassword;
  DELETE_PASSWORD = json.deletePassword;

  if (sessionStorage.getItem("unlocked") === "yes") {
    lockScreen.style.display = "none";
    renderVideos(json.videos);
  }
}

function unlockPage() {
  if (pagePasswordInput.value === PAGE_PASSWORD) {
    sessionStorage.setItem("unlocked", "yes");
    lockScreen.style.display = "none";
    loadVideos();
  } else {
    alert("Wrong password");
  }
}

function getDomain(url) {
  try { return new URL(url).hostname; }
  catch { return "google.com"; }
}

async function addVideo() {
  if (!videoUrl.value.trim()) return;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      url: videoUrl.value,
      title: videoTitle.value
    })
  });
  videoUrl.value = "";
  videoTitle.value = "";
  loadVideos();
}

async function deleteVideo(url) {
  if (prompt("Delete password:") !== DELETE_PASSWORD) return;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "delete", url })
  });
  loadVideos();
}

async function renameTitle(url, title) {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "rename", url, title })
  });
}

async function loadVideos() {
  const res = await fetch(API_URL);
  const json = await res.json();
  renderVideos(json.videos);
}

function renderVideos(data) {
  videoGrid.innerHTML = "";
  data.reverse().forEach(([url, title]) => {
    const card = document.createElement("div");
    card.className = "video-card";
    card.innerHTML = `
      <iframe src="${url}" allowfullscreen></iframe>
      <div class="title" ondblclick="startEdit(this,'${url}')">${title}</div>
      <div class="actions">
        <button class="delete-btn" onclick="deleteVideo('${url}')">ðŸ—‘</button>
      </div>`;
    videoGrid.appendChild(card);
  });
}

function startEdit(el, url) {
  const input = document.createElement("input");
  input.value = el.innerText;
  input.className = "title-edit";
  el.replaceWith(input);
  input.focus();

  input.onblur = async () => {
    await renameTitle(url, input.value);
    loadVideos();
  };
}

init();
</script>

</body>
</html>
